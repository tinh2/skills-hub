# Development Cycle Recall — skills-hub.ai

## Scope
- **Repository:** tinh2/skills-hub
- **Branch:** main (linear, no feature branches)
- **Period:** 2026-02-28 13:58 → 2026-02-28 17:57 (3h 59m wall clock)
- **Total commits:** 22 (including initial scaffold)
- **Total files in repo:** 171 (excluding lockfile)
- **Lines of code:** 12,068 (TS/TSX/CSS)
- **Lines by package:** API 5,007 | Web 3,942 | CLI 1,742 | Shared 998 | Parser 291
- **Net changes post-scaffold:** 130 files, +9,893 / -366 lines

---

## Timeline

```
13:58  /ship Iter1  — Initial scaffold: full-stack monorepo (92 files, 10,288 lines)
14:07  /ship Iter1  — Add visibility, compositions, 8MB upload, rate limiting (+340)
14:23  /ship Iter2  — Fix correctness bugs, API timeouts, auth persistence, pagination (+141/-52)
14:26  /ship Iter3  — Fix domain consistency: reviews, installs, API client (+137/-12)
14:27  /ship Iter3  — Fix CLI safety: YAML escaping, atomic config writes (+60/-45)
14:37  /ship Iter3  — Fix security: granular rate limits, validation, error types (+38/-24)
14:43  /arch-review  — Fix P0/P1 issues: route shadowing, cascades, publish score (+18/-11)
14:46  /readme       — Add comprehensive README (+474)
15:04  /ship Iter1   — Add refresh tokens, install dedup, OAuth CSRF, test suite (+1,058/-45)
15:07  /ship Iter2   — Fix refresh request Content-Type bug (-1)
  ── 2h gap (context limit / new session) ──
17:09  /ship Iter1   — Add likes, featured skills, media, orgs, CLI commands (+4,175/-65)
17:15  /ship Iter1   — Add dashboard, settings, org pages, skill editor, invite flow (+1,612)
17:21  /ship Iter3   — Decompose skill detail page into focused components (+333/-208)
17:25  /ship Iter3   — Add Zod validation for template route + missing API client funcs (+30/-2)
17:33  /ship Iter1   — Add status filter, 404/error pages, mobile nav, dashboard/editor fixes (+166/-51)
17:34  /ship Iter2   — Harden review duplicate check, bundle error handling (+19/-3)
17:36  /ship Iter3   — Fix status filter to include PENDING_REVIEW (+3/-3)
17:48  /e2e          — Add E2E service tests: 77 tests across 4 files (+789)  [PARALLEL]
17:48  /ux           — Accessibility + UX audit: 21 files, ~80 fixes (+175/-91)  [PARALLEL]
17:48  /scale-audit  — Scalability audit report (score: 6/10) (+452)  [PARALLEL]
17:50  /iterate-review — Fix 5 critical scalability issues (+149/-76)
17:57  /iterate-review — Fix critical security + correctness issues (+86/-19)
```

---

## Pipeline Execution Map

```
Canonical:  /mvp → /backend-spec → /arch-review → /si → /ux → /qa → /analyze
Actual:     /ship(1) → /ship(2-harden) → /ship(3-analyze) → /arch-review → /readme
              → /ship(1) → /ship(2) → [2h gap]
              → /ship(1) → /ship(1-cont) → /ship(3-analyze) → /ship(3-analyze-cont)
              → /ship(1) → /ship(2) → /ship(3)
              → (/e2e ∥ /ux ∥ /scale-audit) → /iterate-review(scalability) → /iterate-review(security)
```

**Mapping to canonical:**
- /mvp: ⊘ skipped (research done in prior session, went straight to build)
- /backend-spec: ⊘ skipped (specs embedded in /ship via plan file)
- /arch-review: ✓ executed after first /ship cycle (found 6 P0/P1 issues)
- /ship (×3 cycles): ✓ primary build driver — 3 full ship cycles
- /ux: ✓ executed as parallel agent
- /e2e: ✓ executed as parallel agent
- /scale-audit: ✓ executed (not in canonical, but valuable)
- /qa: ⊘ skipped (rolled into /iterate-review)
- /analyze: ✓ executed as parallel domain + code quality review agents
- /iterate-review: ✓ executed for scalability + security hardening

---

## Sequential vs Parallel Analysis

| Phase | Execution | Dependencies | Could Parallelize? | Est. Time Saved |
|-------|-----------|--------------|-------------------|-----------------|
| Ship Cycle 1 (scaffold) | Sequential | None — foundational | No | — |
| Ship Cycle 1 (harden + analyze) | Sequential | Depends on scaffold | No | — |
| /arch-review + /readme | Sequential | Depends on ship cycle 1 | Could overlap /readme with fixes | ~3m |
| Ship Cycle 2 (auth hardening) | Sequential | Depends on arch-review fixes | No | — |
| **2h gap** | Idle (context limit) | — | — | — |
| Ship Cycle 3 (likes, orgs, UI) | Sequential | Partially independent of auth | Could split backend/frontend | ~10m |
| /e2e ∥ /ux ∥ /scale-audit | **PARALLEL** | Independent file sets | **Already parallelized** | ~8m saved |
| Scalability fixes | Sequential | Depends on scale audit | No | — |
| Security fixes | Sequential | Depends on code review | No | — |

**Parallelization actually used:** Phase 1 quality pipeline ran 3 agents in parallel (E2E tests, UX audit, scale audit) — this was effective and saved significant time.

**Missed parallelization:** The 3 /ship cycles were all sequential on a single branch. The backend org system and the frontend dashboard/settings pages were largely independent and could have been built in parallel as separate worktrees.

---

## Iteration Efficiency

| Skill | Cycles | Iter1 (Build) | Iter2 (Harden) | Iter3 (Analyze) | Iter4 (Final) | Rework % |
|-------|--------|---------------|----------------|-----------------|---------------|----------|
| /ship Cycle 1 | 3 | 10,628 lines | +141/-52 | +235/-81 | — | 4.2% |
| /ship Cycle 2 | 2 | +1,058 | -1 (trivial) | — | — | 0.1% |
| /ship Cycle 3 | 3 | +5,953 | +19/-3 | +33/-5 | — | 0.9% |
| /iterate-review | 2 | +149/-76 (scale) | +86/-19 (security) | — | — | N/A (all fixes) |

**First-time-right ratio:** 10 feature commits / 22 total = 45.5%. However, the "fix" commits were primarily *hardening* (found by systematic analysis), not rework of broken features. True rework (fixing something that was wrong): ~3 commits (Content-Type bug, PENDING_REVIEW missing, refresh request) = **86% first-time-right** for correctness.

---

## Rework Hotspots

| File/Area | Times Modified | Feature | Fix | Root Cause |
|-----------|---------------|---------|-----|------------|
| `apps/web/src/app/skills/[slug]/page.tsx` | 8 | 3 | 5 | Hub file — every feature touches it. Decomposed at commit 8. |
| `apps/web/src/lib/api.ts` | 8 | 4 | 4 | Hub file — every API endpoint adds a client method. |
| `apps/api/src/modules/skill/skill.service.ts` | 7 | 3 | 4 | Hub service — likes, status filter, sort, visibility all modify it. |
| `packages/shared/src/schemas/skill.ts` | 6 | 2 | 4 | Hub schema — every new feature adds fields or enum values. |
| `apps/api/src/modules/auth/auth.service.ts` | 5 | 2 | 3 | Security-sensitive — touched by auth hardening, timeout, CSRF. |
| `apps/api/prisma/schema.prisma` | 5 | 3 | 2 | Foundation — new models (Like, Media, Org) require schema changes. |

**Pattern:** Hub-and-spoke coupling. 6 hub files account for 39/130 total file modifications (30%). This matches the pattern observed in PawPass and other projects.

---

## Co-Change Analysis

Top file pairs that change together:

| Pair | Co-changes | Pattern |
|------|-----------|---------|
| `skill.service.ts` <-> `schemas/skill.ts` | 6x | **Schema-service coupling** — every schema change requires a service update |
| `browse/page.tsx` <-> `skills/[slug]/page.tsx` | 4x | **Page co-change** — browse and detail share display logic |
| `skills/[slug]/page.tsx` <-> `skill-card.tsx` | 4x | **Component coupling** — card changes ripple to detail page |
| `prisma/schema.prisma` <-> `skill.service.ts` | 4x | **ORM coupling** — schema migrations require service updates |

**Insight:** The `skill.service.ts` → `schemas/skill.ts` → `api.ts` → `skill-card.tsx` → `page.tsx` chain is the critical coupling path. Changes at any point in this chain tend to cascade through the rest.

---

## Dependency Graph

```
                    ┌─────────────┐
                    │ prisma.schema│ (foundation)
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
        ┌──────────┐ ┌──────────┐ ┌──────────┐
        │skill.svc │ │review.svc│ │ org.svc  │
        └────┬─────┘ └────┬─────┘ └────┬─────┘
             │             │            │
        ┌────┴─────────────┴────────────┘
        ▼
  ┌──────────────┐
  │schemas/skill │ (hub)
  │schemas/org   │
  └──────┬───────┘
         │
    ┌────┴────┐
    ▼         ▼
┌────────┐ ┌────────────────┐
│ api.ts │ │ skill-card.tsx  │
│(client)│ │ review-card.tsx │
└───┬────┘ │ media-gallery   │
    │      └───────┬────────┘
    ▼              ▼
┌──────────────────────────┐
│  Page components         │
│  (browse, detail, dash)  │
└──────────────────────────┘
```

**Critical path:** Schema → Service → Shared types/schemas → API client → Components → Pages

---

## Timing Analysis

| Metric | Value |
|--------|-------|
| Wall clock time | 3h 59m |
| Active dev time (excluding 2h gap) | ~1h 59m |
| Avg time between commits | 5.5m (excluding gap) |
| Fastest commit burst | 3 commits in 0-1 minute (parallel agents at 17:48) |
| Longest gap (within active time) | 18m (before auth hardening cycle) |
| Biggest single commit | 71 files, +4,175 lines (likes/orgs/media mega-commit) |

**Burst patterns:**
1. **13:58-14:46** — First /ship cycle: 8 commits in 48m (scaffold → harden → analyze → arch-review → readme)
2. **15:04-15:07** — Auth hardening: 2 commits in 3m
3. **17:09-17:57** — Final sprint: 12 commits in 48m (features → decompose → analyze → parallel agents → fixes)

---

## Key Insights

### What Worked

1. **Plan file as architecture blueprint** — The 3-phase plan (likes → featured → media) served as the roadmap for the massive +4,175 line commit. Having the plan pre-approved meant zero rework on feature design.

2. **Parallel quality agents** — Running /e2e, /ux, and /scale-audit simultaneously at 17:48 was highly effective. All three completed without conflicts, found real issues, and the combined output was immediately actionable.

3. **Systematic analysis gates** — Each /ship cycle included a hardening + analysis pass. This caught the PENDING_REVIEW enum gap, missing Zod validation on template routes, and review duplicate check — all before they became bugs in production.

4. **File decomposition at 500-line threshold** — Proactively splitting the skill detail page (784 → 492 lines + 3 extracted components) at commit 8 prevented it from becoming a monolithic hotspot.

5. **Atomic security pass** — Running domain analysis + code quality review in parallel, then fixing all critical findings in 2 focused commits, was more efficient than interleaving security fixes with feature work.

### What Caused Unnecessary Rework

1. **71-file mega-commit** — The `be822f6` commit touched 71 files (+4,175 lines) in a single commit. This made it impossible to isolate problems later. The dashboard/settings/org pages should have been separate commits. **Recommendation:** Cap /ship iteration 1 at ~15-20 files per commit; split larger features into logical commits.

2. **Hub file churn** — `skill.service.ts` was modified 7 times, `api.ts` 8 times. Each new feature required touching these hubs. **Recommendation:** Consider a registry/plugin pattern for the API client (auto-discover endpoints) and use composition over modification in services.

3. **Late auth hardening** — The 2h gap was caused by running out of context mid-pipeline. Auth features (refresh tokens, CSRF) were built as a separate /ship cycle rather than being included in the initial scaffold. **Recommendation:** Build auth into the initial scaffold; it's always needed and adding it later touches many files.

4. **Missing ORG visibility handling** — The ORG visibility value existed in the schema from day 1 but was never handled in skill-card.tsx until the final security pass. This is a "late discovery" pattern. **Recommendation:** When adding enum values, grep for all switch/conditional statements that match on the enum and update them in the same commit.

### Bottlenecks

1. **Context limit at 2h mark** — Lost momentum for ~2h due to context window exhaustion. This is inherent to the tool but could be mitigated by smaller, more focused /ship cycles.

2. **Sequential feature building** — Backend orgs, frontend orgs, and CLI commands were all built sequentially in one mega-commit. The backend could have been built and tested independently while a second agent built the frontend.

3. **No database available for integration testing** — All 120 tests are unit tests with mocked Prisma. No integration tests verify actual SQL queries, which is why the ILIKE and DISTINCT ON issues weren't caught until the scale audit.

---

## Quality Metrics

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 22 | — |
| Feature commits | 10 (45%) | — |
| Fix/harden commits | 10 (45%) | — |
| Refactor commits | 1 (5%) | — |
| Doc commits | 1 (5%) | — |
| True rework commits | 3 (14%) | Good — most "fixes" were analysis-driven hardening |
| First-time-right (correctness) | 86% | Strong |
| First-time-right (completeness) | 45% | Expected for iterative approach |
| Test coverage files | 7 API + 9 shared/parser = 16 | Good backend, zero frontend |
| Tests per LOC | 120 tests / 12,068 LOC = 1:100 | Needs improvement |
| Hub file modifications | 39 of 130 total (30%) | Typical hub-spoke pattern |
| Parallel agent utilization | 3 agents, 1 phase | Could expand to 2 phases |
| Lines per hour (active) | ~6,050 | Very high throughput |

---

## Recommendations for Next Iteration

1. **Split mega-commits into logical units** — The 71-file commit is the #1 risk. Target ≤15 files per commit. When /ship builds a large feature, pause mid-iteration to commit backend, then frontend, then CLI separately. **Impact:** Easier bisection, cleaner git blame, faster code review.

2. **Parallelize backend and frontend feature work** — Use 2 agents or worktrees: one for `apps/api` + `packages/shared`, one for `apps/web`. They share types via the shared package but don't touch each other's files. **Impact:** Could save 15-20m per large feature phase.

3. **Build auth and orgs into the initial scaffold** — Auth (refresh tokens, CSRF) and org infrastructure are always needed. Include them in iteration 1 to avoid a separate hardening cycle. **Impact:** Eliminates 1 full /ship cycle.

4. **Add integration tests with a real database** — The current 120 mocked unit tests miss query-level issues (ILIKE performance, DISTINCT ON correctness, connection pool behavior). Add a `docker compose up -d` step and run 10-20 integration tests against PostgreSQL. **Impact:** Catches C1-C5 scalability issues during development, not in a post-build audit.

5. **Auto-verify enum exhaustiveness** — When adding a new enum value (like ORG visibility), grep all switch/case/ternary statements that match on the enum and verify they handle the new value. Could be a pre-commit hook. **Impact:** Prevents "late discovery" of unhandled enum values.

6. **Run /scale-audit earlier** — The scale audit found 5 critical issues that required a full fix pass. Running it after iteration 2 (harden) instead of after iteration 3 (analyze) would have caught these earlier. **Impact:** Reduces fix-commit count by batching scalability fixes with other hardening.

---

## Suggested Pipeline for Next Build

```
┌──────────────────────────────────────────────────────────────┐
│  /ship Iteration 1: Scaffold + Auth + Core Feature           │
│  Target: ≤20 files per commit, split backend/frontend        │
│  Include: auth, org infra, core CRUD, CLI basics             │
│  Gate: pnpm build && pnpm test                               │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌──────────────────────────────────────────────────────────────┐
│  /ship Iteration 2: Harden + /arch-review                    │
│  Fix correctness, add test suite (unit + integration)        │
│  Gate: 77+ tests passing, build clean                        │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌─────────────── PARALLEL ─────────────────────────────────────┐
│  Agent 1: /ship Iter3 (domain analysis + fixes)              │
│  Agent 2: /scale-audit (identify bottlenecks early)          │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌──────────────────────────────────────────────────────────────┐
│  /ship Iteration 1: Secondary features (split into 2 agents) │
│  Agent 1: Backend services + shared types                    │
│  Agent 2: Frontend pages + components                        │
│  Gate: pnpm build && pnpm test                               │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌─────────────── PARALLEL ─────────────────────────────────────┐
│  /e2e (4 test files)  ∥  /ux (a11y audit)                    │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌──────────────────────────────────────────────────────────────┐
│  /iterate-review: Security + scalability fix pass            │
│  Domain analysis + code quality review → targeted fixes      │
└──────────────────────┬───────────────────────────────────────┘
                       ▼
┌──────────────────────────────────────────────────────────────┐
│  /readme                                                      │
└──────────────────────────────────────────────────────────────┘
```

**Key changes from this build:**
- Scale audit runs earlier (parallel with iteration 3, not after)
- Secondary features split across 2 parallel agents (backend/frontend)
- Auth + orgs included in initial scaffold
- Integration tests added in iteration 2
- Max 15-20 files per commit enforced
